# Лабораторная работа №5: мониторинг сервера, поднятого в кубере

## Цель работы:
Сделать мониторинг сервиса, поднятого в кубере (использовать, например, prometheus и grafana). Показать хотя бы два рабочих графика, которые будут отражать состояние системы. Приложить скриншоты всего процесса настройки.

## Ход работы:

в ходе выполнения лабораторных работ у нас немного перераспределились обязанности, так что 3-ю и 5-ю лабораторные выполняли разные люди)) но, к счастью, моя коллега написала подробнейшую инструкцию-отчет, и по ней я быстро (за 2 часа) справилась с тем, чтобы поднять сервер в кубере. подготовка пройдена, осталось всего-то сделать лабу 

![image](https://github.com/user-attachments/assets/589bda69-46ac-4196-8843-0bf8ea1dc88d)

ps. тут в дальнейшем могут быть некоторые несвязности в скринах, потому что я просто скринила все сразу, и по окончании работы все остановила и закрыла. и только сейчас вставляю в отчет и замечаю, что пропускала в скринах некоторые команды хихи)) 
для того, чтобы не сталкиваться с проблемой того, что "аннотации некоторых объектов CustomResourceDefinition в манифесте Prometheus Operator превышают допустимый размер" (ну вернее уже после того, как мы с этим столкнулись), используем для установки графаны и прометеуса helm -- пакетный менеджер для Kubernetes для установки Prometheus и Grafana. lля установки Helm мы скачали скрипт с официального сайта и установили его на виртуальной машине

![image](https://github.com/user-attachments/assets/fc022499-464c-4276-9767-bce714cfbc56)

затем мы добавляем репозитории (задокументирован только скриншот с графаной) и устанавливаем все, что надо (мне просто надоело повторно писать "графана" и "прометеус"):

![image](https://github.com/user-attachments/assets/fee01192-7009-49e0-aa2b-98b3d372d6ac)

тут нам желают хэппи хелминга -- могу спойлернуть и сказать, что хелминг реально выдался очень хэппи
на всякий случай проверяем, что все поднялось как надо

![image](https://github.com/user-attachments/assets/d6bb8075-b672-42a7-be37-c863e6987064)

далее происходит чистая магия (я четвертый год учусь, но все еще каждый раз удивляюсь, когда в браузере открывается страничка локалхост и там даже не вылазит ошибка). открываем в браузере хост на порту 3000 и видим графану. меняем пароль при первом входе и подключаем прометеус через data sources. перед этим перебрасываем сервер прометеуса на 9090 порт, вставляем его в url и теперь точно происходит что-то волшебное -- прометеус и графана законнектились, можем делать дашборды!

![image](https://github.com/user-attachments/assets/752fbecd-2cdb-4f64-9cde-002dc22e28a3)

![image](https://github.com/user-attachments/assets/1654f5fd-6fb0-4aa4-a191-e5ce6122d5ce)

![image](https://github.com/user-attachments/assets/e330b7f9-1fd9-44dd-b6ca-26ddaff7baa9)

ну и приступаем к тому, для чего мы все это затеяли. добавляем на график мониторинг использования процессора (rate(node_cpu_seconds_total{mode!="idle"}[1m])) и использования памяти (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100). ну вроде все ровненько и красивенько...

![image](https://github.com/user-attachments/assets/25d089f7-2af5-4a96-b4ff-07bf630a8667)

![image](https://github.com/user-attachments/assets/16664394-0277-4d0a-b96c-1ef585e04b7c)

теперь, когда Prometheus и Grafana работают, мы можем наблюдать за состоянием нашего сервера и получать визуальные отчеты о его метках и производительности! не то чтобы это сильно полезно для приложения, которое выводит "hello world", но определенно может пригодиться для чего-то более сложного (надеюсь, не мне)
