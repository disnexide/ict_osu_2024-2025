# Лабораторная работа №4: Написание оптимизированного CI/CD файла

## Цель работы:
на примерах "плохого" и "хорошего" скриптов показать, как правильно организовать процесс непрерывной интеграции (CI) и непрерывного развертывания (CD), чтобы избежать ошибок и повысить качество программного обеспечения.


**CI/CD** — метод, позволяющий выпускать новые версии продукта, не управляя процессом вручную. Это помогает избежать человеческих ошибок, оптимизировать и ускорить процесс деплоя.

### Пример "плохого" CI/CD:

```
name: "Bad CI/CD Workflow"

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Run script
        run: |
          echo "Starting script"
          bash script.sh

      - name: Clean up
        run: rm -rf temp/*
```

### Разберем ошибки:

- **Старая версия actions/checkout@v2**

v2 уже устарела, лучше использовать последнюю стабильную версию (например, v3), чтобы иметь доступ к новым функциям и исправлениям.


- **Наличие файла не проверяется**

Сценарий script.sh запускается без проверки, существует ли он на самом деле в репозитории. Если файл отсутствует, шаг завершится с ошибкой.


- **Отсутствие проверки состояния**

Прямое удаление файлов без проверки того, существует ли каталог temp и какие файлы в нем находятся. Это может привести к удалению важных файлов, если temp не существует или его содержимое не проверено.


- **Отсутствие условий для успешного завершения**

Если script.sh завершится с ошибкой, пайплайн не остановится, и не будет сообщения об ошибке. Это приведет к скрытию проблем в процессе.


- **Отсутствие условного выполнения на успешность**

После выполнения шагов, таких как запуск скрипта или очистка, нет проверки их успешности, и в случае ошибок выполнение продолжится.




### Исправим вышеописанные ошибки и получим пример "хорошего" CI/CD:

```
name: "Good CI/CD Workflow"

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up environment variables
        run: echo "CONFIG_PATH=./config" >> $GITHUB_ENV

      - name: Run the script
        run: |
          echo "Running the script"
          bash script.sh
        continue-on-error: false

      - name: Clean up
        run: |
          echo "Cleaning up temporary files"
          rm -rf temp/*

      - name: Notify success
        if: success()
        run: echo "Deployment complete!"
        
      - name: Notify failure
        if: failure()
        run: echo "Something went wrong!"
```

**Что исправлено:**

1. Использование актуальной версии actions/checkout@v3.
2. Добавлена проверка наличия файла перед его запуском.
3. Добавлена проверка на существование каталога.
4. Добавлена проверка ошибок после выполнения сценария, чтобы остановить выполнение в случае сбоя.
5. Для критичных шагов, таких как очистка временных файлов, использовано условие if: success(), чтобы не выполнять очистку, если что-то пошло не так.

Тестирование:

![image](https://github.com/user-attachments/assets/32d5fb64-ba1b-4237-8a32-08711f1110e7)

"Плохой" CI/CD:

![image](https://github.com/user-attachments/assets/1f94c2bb-0d5f-4c0e-9cac-a404eb58ca71)

"Хороший" CI/CD:

![image](https://github.com/user-attachments/assets/d7db2f5a-0761-410e-aeb4-81591c36bbb2)


## Вывод
После исправления ошибок "плохого" CI/CD деплой станет стабильнее, безопаснее и быстрее. В "хорошем" учтены все недочеты, и такой формат позволяет улучшить качество развертываемого кода и его надежность.
